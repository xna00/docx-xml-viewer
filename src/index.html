<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OOXML Viewer - 在线预览 Office Open XML 文件</title>
    <meta name="description" content="OOXML Viewer 是一个在线工具，支持上传并预览 Office Open XML 文件（docx、xlsx、pptx）内部的 XML 内容，自动解压并高亮显示。">
    <meta name="keywords" content="ooxml, docx, xlsx, pptx, XML, Office, Word, Excel, PowerPoint, 在线预览, 文件解压, 高亮显示">
    <style>
        :target {
            background: yellow;
        }
    </style>
</head>

<body>
    <input type="file" id="fileInput">
    <div style="display: flex;">
        <div id="fileList" style="width: 280px;">
        </div>

        <pure-xml-view id="my-viewer" style="flex: 1;"></pure-xml-view>

    </div>
    <script type="module">
        import * as zip from 'https://esm.sh/@zip.js/zip.js'
        import 'https://esm.sh/pure-xml-view'
        let entries = [];

        document.getElementById('fileInput').addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new zip.ZipReader(new zip.BlobReader(file));
                entries = await reader.getEntries();
                await reader.close();
                document.getElementById('fileList').innerHTML = entries.map(e => `
                <div>
                <a id="${e.filename}" href="#${e.filename}">${e.filename}</a>
                </div>
                    `).join('');

                setTimeout(() => {
                    (document.getElementById('word/document.xml')
                        ?? document.getElementById('ppt/presentation.xml')
                        ?? document.getElementById('xl/workbook.xml')
                    )?.click();
                }, 100);
                document.getElementById('fileList').addEventListener('click', async (e) => {
                    if (e.target && e.target.nodeName === "A") {
                        const entry = entries.find(en => en.filename === e.target.id);
                        if (entry) {
                            const text = await entry.getData(new zip.TextWriter());
                            console.log(text);
                            const viewer = document.getElementById('my-viewer');
                            viewer.setXmlData(text);

                            const xmlDoc = new DOMParser().parseFromString(text, "application/xml");
                            console.log(xmlDoc);

                        }
                    }
                });
            }
        });

    </script>
</body>

</html>